# Phase 3E: 統合テスト

## 概要

Phase 3のエンドツーエンドテストを行います。

## テスト内容

### 1. 主菜→副菜→汁物の段階的選択

- **テストケース**: TC-001 基本フロー
  - 主菜5件提案 → 選択 → 副菜5件提案 → 選択 → 汁物5件提案 → 選択 → 完了
  - 各段階で選択UIが表示されることを確認
  - 自動遷移が動作することを確認

### 2. カテゴリ連動テスト

- **テストケース**: TC-002 和食連動
  - 和食の主菜 → 和食の副菜 → 味噌汁
  - カテゴリが正しく判定されることを確認
  
- **テストケース**: TC-003 洋食連動
  - 洋食の主菜 → 洋食の副菜 → スープ
  - カテゴリが正しく判定されることを確認

### 3. エラーハンドリング

- **テストケース**: TC-004 副菜が見つからない場合
  - 主菜で使った食材が多く、副菜が見つからない
  - 適切なエラーメッセージが表示されることを確認
  
- **テストケース**: TC-005 汁物が見つからない場合
  - 主菜・副菜で使った食材が多く、汁物が見つからない
  - 適切なエラーメッセージが表示されることを確認

### 4. 使い残し食材の活用

- **テストケース**: TC-006 食材を効率的に使う
  - 主菜で使っていない食材で副菜を提案
  - 主菜・副菜で使っていない食材で汁物を提案
  - 食材が最大限活用されることを確認

---

## テスト実施手順

### 統合テスト環境のセットアップ
1. バックエンドサーバー起動: `python -m uvicorn api.main:app --reload`
2. フロントエンド起動: `cd /app/Morizo-web && npm run dev`
3. テスト用ユーザーでログイン

### テストシナリオ

#### TC-001: 基本フローの段階的選択
**テスト手順**:
1. 「レンコンの主菜を5件提案して」と入力
2. 主菜5件が表示される → 1件を選択
3. 自動的に副菜提案が開始される
4. 副菜5件が表示される → 1件を選択
5. 自動的に汁物提案が開始される
6. 汁物5件が表示される → 1件を選択
7. 「献立が完成しました」のメッセージが表示される

**期待結果**:
- 各段階で5件の候補が提案される
- 自動遷移が動作する
- 選択履歴が表示される

#### TC-002: 和食連動テスト
**テスト手順**:
1. 「和食の主菜を5件提案して」と入力
2. 主菜を選択（和食系の料理）
3. 副菜が提案される（和食系）
4. 副菜を選択
5. 汁物提案で「味噌汁」が提案される

**期待結果**:
- カテゴリが"japanese"に判定される
- 汁物が"味噌汁"として提案される

#### TC-003: 洋食連動テスト
**テスト手順**:
1. 「洋食の主菜を5件提案して」と入力
2. 主菜を選択（洋食系の料理、例: スパゲッティ）
3. 副菜が提案される（洋食系、例: サラダ）
4. 副菜を選択
5. 汁物提案で「スープ」が提案される

**期待結果**:
- カテゴリが"western"に判定される
- 汁物が"スープ"として提案される

#### TC-004: エラーハンドリング（副菜が見つからない）
**テスト手順**:
1. 在庫に食材が1種類しかない場合
2. 主菜提案 → 選択
3. 副菜提案を試みる
4. エラーメッセージが表示される

**期待結果**:
- 「副菜が見つかりませんでした」のメッセージ
- または「主菜選定に戻る」のオプション

#### TC-005: 使い残し食材の活用
**テスト手順**:
1. 在庫: レンコン、ニンジン、ピーマン、鶏肉、豆腐、わかめ
2. 主菜でレンコンと鶏肉を使用
3. 副菜でピーマンを使用
4. 汁物で豆腐とわかめを使用

**期待結果**:
- 使い残し食材が最小限になる
- 全ての食材が活用される

---

## 期待される効果

- 段階的選択システムが正常に動作することを確認
- エラー時の適切な処理を確認
- ユーザー体験が向上することを確認

