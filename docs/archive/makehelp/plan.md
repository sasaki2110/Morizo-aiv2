# ヘルプ機能充実化 - 実装プラン

## 概要

Morizo AIのヘルプ機能を充実させ、ユーザーが「使い方を教えて」と入力することで、段階的に機能の説明を受けられるようにします。

## 実現可能性の評価

### 1. プレースホルダー変更
- **実現可能性**: 高
- **場所**: フロントエンド（`/app/Morizo-web/components/ChatSection.tsx` または `ChatInput.tsx`）
- **注意**: フロントエンドは別リポジトリの可能性があるため、実ファイルの場所を確認する必要があります

### 2. ヘルプ機能（段階的応答）
- **実現可能性**: 高
- **実装方針**:
  - `TrueReactAgent.process_request()`で「使い方を教えて」を検知
  - セッション状態でヘルプの段階（全体概要→機能別詳細）を管理
  - 数字入力（「1」「2」など）で機能別詳細に遷移

## 機能仕様

### ユーザー操作フロー

1. **初期状態**
   - プレースホルダー: `メッセージを入力してください...または 使い方を教えて...`
   - ユーザー入力: `使い方を教えて`

2. **全体概要の表示**
   - 回答:
     ```
     Morizo AIには３つの使い方と２つの補助機能があります。
     
     1. チャットによる在庫操作
     2. チャットによる献立一括提案
     3. チャットによる主菜・副菜・汁物の段階的提案と選択
     4. 補助機能
     
     どの機能について知りたいですか？
     ```

3. **機能別詳細の表示（ユーザーが「1」と入力）**
   - 回答:
     ```
     主に４つの操作があります。
     
     1. 在庫追加
     大根を１本追加して とチャットに入力すれば、大根が追加されます。
     
     2. 在庫削除
     牛乳を削除して とチャットに入力すれば、牛乳を削除します。
     もし、牛乳が複数あって選択が必要な場合は、どの牛乳を削除するか聞き返しますので、
     削除する対象を選んで下さい。
     
     3. 在庫変更
     ジャガイモを２個に変えて とチャットに入力すれば、ジャガイモの数量を変更します。
     
     4. 在庫一覧
     在庫を教えて とチャットに入力すれば、今の在庫を一覧表示します。
     ```

## 実装計画

### バックエンド実装（このプロジェクト内）

#### 修正1: ヘルプハンドラの作成

**修正する場所**: `/app/Morizo-aiv2/core/help_handler.py`（新規作成）

**修正する内容**:
- ヘルプ全体概要の返答を生成する関数
- 機能別詳細の返答を生成する関数
  - `1` = 在庫操作
  - `2` = 献立一括提案
  - `3` = 段階的提案と選択
  - `4` = 補助機能

**修正の理由**: ヘルプ処理を専用ハンドラに分離し、コードの可読性と保守性を向上させる

**修正の影響**: 新規ファイルの追加のみ（既存機能への影響なし）

---

#### 修正2: TrueReactAgentにヘルプ検知機能を追加

**修正する場所**: `/app/Morizo-aiv2/core/agent.py` の `process_request()` メソッド（約89行目付近）

**修正する内容**:
- リクエストの冒頭で「使い方を教えて」などのヘルプキーワードを検知
- セッション状態を確認し、ヘルプハンドラを呼び出し
- 数字入力（「1」「2」など）で機能別詳細に遷移する処理

**修正の理由**: ヘルプリクエストを通常のタスク処理より先に判定し、専用処理を行うため

**修正の影響**: 既存のリクエスト処理フローに条件分岐を追加（既存機能への影響は最小限）

---

#### 修正3: セッション状態でのヘルプ段階管理

**修正する場所**: `/app/Morizo-aiv2/services/session_service.py`（既存のセッション管理を活用）

**修正する内容**:
- ヘルプ状態（`help_state`: `overview` または `detail_1`/`detail_2`/`detail_3`/`detail_4`）をセッションに保存

**修正の理由**: ヘルプの段階（全体概要→機能別詳細）を管理するため

**修正の影響**: セッション管理に新規フィールドを追加（既存機能への影響は最小限）

---

### フロントエンド実装（別プロジェクト `/app/Morizo-web`）

#### 修正4: プレースホルダーの変更

**修正する場所**: `/app/Morizo-web/components/ChatSection.tsx` または `/app/Morizo-web/components/ChatInput.tsx`

**修正する内容**:
- 現在: `placeholder="メッセージを入力してください..."`
- 変更後: `placeholder="メッセージを入力してください...または 使い方を教えて..."`

**修正の理由**: ヘルプ機能の存在をユーザーに案内するため

**修正の影響**: プレースホルダーテキストの変更のみ（機能への影響なし）

---

## 注意事項

1. **フロントエンドの場所確認**: フロントエンドは別リポジトリの可能性があるため、実ファイルの場所を確認する必要があります
2. **ヘルプキーワードの判定精度**: 「使い方を教えて」などのヘルプキーワードの判定を、誤検知を避けるように実装する必要があります（例：「使い方」だけでは検知しない）
3. **セッション管理の拡張**: セッション管理の拡張は、既存のセッション処理に影響しないように実装する必要があります

## 実装順序

1. バックエンド: ヘルプハンドラの作成（修正1）
2. バックエンド: セッション状態管理の拡張（修正3）
3. バックエンド: TrueReactAgentにヘルプ検知機能を追加（修正2）
4. フロントエンド: プレースホルダーの変更（修正4）

## テスト項目

### バックエンド

1. **ヘルプ全体概要の表示**
   - 「使い方を教えて」で全体概要が表示されること
   - セッション状態が `help_state: overview` になること

2. **機能別詳細の表示**
   - 「1」で在庫操作の詳細が表示されること
   - 「2」で献立一括提案の詳細が表示されること
   - 「3」で段階的提案の詳細が表示されること
   - 「4」で補助機能の詳細が表示されること

3. **セッション状態の管理**
   - ヘルプ状態が正しく保存・取得されること
   - 通常のチャットに戻った際にヘルプ状態がリセットされること

### フロントエンド

1. **プレースホルダーの表示**
   - 新しいプレースホルダーが正しく表示されること

