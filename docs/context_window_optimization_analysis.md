# コンテキストウインドウ最適化分析

## 目的
コーディング支援AIのコンテキストウインドウ有効活用のための最適化戦略比較

## 現状分析

### ファイル数と行数
| カテゴリ | ファイル数 | 総行数 | 平均ファイルサイズ |
|---------|-----------|--------|------------------|
| **ソースコード** | 80ファイル | 10,082行 | **126行/ファイル** |
| ドキュメント(.md) | 56ファイル | 15,161行 | 271行/ファイル |
| テスト(tests/*.py) | 66ファイル | 15,541行 | 236行/ファイル |

### 上位肥大ファイルの状況
- 上位10ファイルで約3,500行（全体の約35%）
- 最大ファイル: 468行
- 平均ファイルサイズ: 126行

## 3つの選択肢の効果分析

### 1. ソースコードのダイエット（ファイル分割）

#### 効果
✅ **最も有効**
- **ファイルサイズの削減**: 大きなファイルを小さく分割することで、一度に読み込める関連ファイル数が**劇的に増加**
- **関連コードの検索効率**: 必要な部分だけを読み込めるため、不要なコードをスキップ可能
- **コンテキストの精度向上**: 小さいファイル単位で理解できるため、AIの判断精度が向上

#### 具体的な効果測定
現在の状況：
- 最大ファイル468行を読み込むと、コンテキストの約4.6%を消費（10,082行中）
- 上位3ファイル（468+461+388=1,317行）で約13%を消費

改善後（仮定：ファイルを100行以下に分割）：
- 468行ファイル → 約5ファイルに分割
- 一度に読み込める関連ファイル数が**5倍以上**に増加
- 必要な機能だけをピンポイントで読み込み可能

#### 効果指数: ⭐⭐⭐⭐⭐ (5/5)

---

### 2. 不要なドキュメント(.md)の削除

#### 効果
🟡 **中程度**
- **削減量**: 56ファイル、15,161行（最大の総行数）
- **コンテキスト消費**: ドキュメントは通常、コード理解時に自動で読み込まれにくい
- **手動指定時のみ影響**: 明示的にドキュメントを参照する場合のみコンテキストを消費

#### 問題点
- AIが自動的にコードを理解する際、通常はドキュメントファイルは読み込まれない
- コード内のコメントやdocstringの方が重要
- `.md`ファイルは検索や参照時にのみ読み込まれる可能性が高い

#### 効果指数: ⭐⭐ (2/5)

---

### 3. 不要なテスト(tests/*.py)の削除

#### 効果
🟡 **中程度**
- **削減量**: 66ファイル、15,541行（最大の総行数）
- **コンテキスト消費**: テストファイルは通常、テスト実行時やデバッグ時にのみ読み込まれる
- **既存の除外設定**: 既に`tests`ディレクトリは分析対象外として除外されている

#### 問題点
- テストファイルは通常、コード理解時には自動で読み込まれない
- ただし、テストコードから実装を理解する場合（逆方向の理解）には有用
- すでに除外設定されている可能性が高い

#### 効果指数: ⭐⭐ (2/5)

---

## 結論と推奨

### 🏆 最優先: ソースコードのダイエット

**理由:**
1. **直接的な効果**: コードファイルは常にコンテキストに含まれる可能性が高い
2. **読み込み頻度**: AIがコードを理解・修正する際、ソースコードが最も頻繁に読み込まれる
3. **ファイルサイズの影響**: 大きなファイル（468行など）は1ファイルだけでコンテキストの約5%を消費
4. **検索効率**: 小さなファイルに分割することで、必要な部分だけをピンポイントで読み込み可能

### 📊 効果の定量的比較

#### シナリオ1: ソースコードのダイエット実施後
- 468行ファイルを5ファイル（各100行以下）に分割
- コンテキスト内で一度に読み込める関連ファイル数: **5倍以上**
- 不要なコードを読み込むリスク: **80%削減**

#### シナリオ2: ドキュメント削除
- 15,161行削減（ただし、通常は読み込まれない）
- 実際のコンテキスト消費削減: **ほぼゼロ**（自動読み込みされないため）

#### シナリオ3: テスト削除
- 15,541行削減（ただし、既に除外設定の可能性）
- 実際のコンテキスト消費削減: **限定的**（テストは通常自動読み込みされない）

## 推奨アクション

1. **最優先**: ソースコードのダイエット
   - 特に上位10ファイル（468行〜251行）から着手
   - 目標: 各ファイル100行以下（サービス層）、150行以下（コア層）

2. **副次的**: ドキュメントとテストの整理
   - 完全に不要なファイルのみ削除
   - ただし、効果は限定的

## 注意事項

- ソースコードのダイエットは、**後方互換性とテストの維持**が必須
- ファイル分割時は、**責任の分離**と**依存関係の整理**が重要
- 単純にファイルを分割するのではなく、**適切な設計原則に基づく**分割が必要

