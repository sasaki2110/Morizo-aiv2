#!/usr/bin/env python3
"""
HelpHandler - ヘルプ機能ハンドラ

段階的なヘルプ応答を生成する
"""

from typing import Optional
from config.loggers import GenericLogger


class HelpHandler:
    """ヘルプ機能ハンドラ"""
    
    def __init__(self):
        self.logger = GenericLogger("core", "help_handler")
    
    def generate_overview(self) -> str:
        """全体概要の応答を生成"""
        return """Morizo AIには、主に4つの便利な機能があります。

1. **在庫管理** - 冷蔵庫やパントリーにある食材を管理できます
2. **献立提案（一括）** - 在庫から一気に献立を考えてくれます
3. **献立提案（段階的）** - 主菜から順番に選んでいけます
4. **便利な補助機能** - 過去の献立を見たり、レシピを保存したり

どの機能について知りたいですか？（1〜4の数字を入力してください）"""
    
    def generate_inventory_detail(self) -> str:
        """在庫管理機能の詳細応答を生成"""
        return """在庫管理機能では、チャットで簡単に食材の追加・削除・変更・確認ができます。

### 食材を追加する

「大根を１本追加して」と入力するだけで、在庫に追加されます。

**使い方の例**:
- 大根を１本追加して
- りんごを5個追加して
- 牛乳を1L追加して

数量や単位を省略しても大丈夫です。そのまま追加されます。

**確認は不要**: すぐに追加されるので、待つ時間はありません。

### 食材を削除する

「牛乳を削除して」と入力すると、在庫から削除されます。

**同じ食材が複数ある場合**:
もし同じ食材が複数ある場合は、次のように聞かれます。この場合は、上記の選択肢から選んで答えてください。

**確認を避けたい場合**:
最初から「最新の牛乳を削除して」「古い牛乳を削除して」「全部の牛乳を削除して」と言えば、確認なしで実行されます。

### 食材の数量などを変更する

「ジャガイモを２個に変えて」と入力すると、数量を変更できます。

**変更できる内容**:
- 数量: 「ジャガイモを２個に変えて」
- 単位: 「牛乳の単位をパックに変えて」
- 保存場所: 「牛乳の保存場所を冷凍庫に変えて」

**確認を避けたい場合**:
「最新の」「古い」「全部の」を最初につけると、確認なしで実行されます。

### 在庫を確認する

「在庫を教えて」と入力すると、今ある食材の一覧が表示されます。

**確認は不要**: すぐに表示されるので、待つ時間はありません。

他に知りたいことはありますか？"""
    
    def generate_menu_bulk_detail(self) -> str:
        """献立一括提案機能の詳細応答を生成"""
        return """在庫にある食材から、主菜・副菜・汁物を一気に提案してくれる機能です。

### 使い方

次のような言い方で献立を提案してもらえます：
- 献立を教えて
- レシピを提案して
- 在庫から作れるメニューは？
- 今日の献立を考えて

**確認は不要**: すぐに提案が始まります。

### どんな献立が提案されるの？

在庫の食材から、2種類の献立を提案します：
1. **新しい献立**: あなたの在庫に合わせて、独創的な献立を考えます
2. **過去の類似献立**: これまでに作ったことがあるような、親しみやすい献立を提案します

どちらも、主菜・副菜・汁物がセットになっています。

### レシピの詳細も見れる？

はい！提案された献立の各レシピについて、レシピページへのリンクも一緒に表示されます。クリックすると、詳しい作り方を見ることができます。

### 注意点

- 在庫が空っぽだと、提案が難しい場合があります
- 過去14日間に作った献立は、重複しないように配慮されます

他に知りたいことはありますか？"""
    
    def generate_menu_staged_detail(self) -> str:
        """献立提案（段階的）機能の詳細応答を生成"""
        return """主菜から順番に選んでいく、段階的な献立提案機能です。

### 主菜を選ぶ

まずは主菜から選びます。

**使い方の例**:
- 主菜を5件提案して
- レンコンを使った主菜を教えて
- メインを提案して

**主菜を指定したい場合**:
「レンコンを使った主菜を教えて」のように、食材を指定すると、その食材を使った主菜が優先的に提案されます。

**食材を指定しない場合**:
食材を指定せずに「主菜を5件提案して」と言うと、次のように聞かれます：

「なにか主な食材を指定しますか？それとも今の在庫から作れる主菜を提案しましょうか？」

どちらかを選んでください。

**主菜の候補が表示されます**:
5件の主菜候補が番号付きで表示されるので、気に入ったものを選んでください。気に入らなければ「他の提案を見る」ボタンで、追加で5件ずつ提案してもらえます。

### 副菜を選ぶ

主菜を選んだら、次は副菜です。

主菜で使っていない食材を優先的に使った副菜が提案されます。無駄なく食材を使えますね！

**副菜の候補が表示されます**:
5件の副菜候補が表示されるので、選んでください。「他の提案を見る」ボタンで追加提案も可能です。

### 汁物を選ぶ

副菜を選んだら、最後は汁物です。

- 和食の献立の場合は「味噌汁」
- それ以外の場合は「スープ」

主菜・副菜で使っていない食材を優先的に使った汁物が提案されます。

**汁物の候補が表示されます**:
5件の汁物候補が表示されるので、選んでください。「他の提案を見る」ボタンで追加提案も可能です。

### 追加提案機能（もっと見たい！）

提案された候補に気に入ったものがない場合、「他の提案を見る」ボタンをクリックすると、追加で5件ずつ提案してもらえます。

**何度でも可能**: 納得するまで、何度でも追加提案ができます。

### 選んだ献立を保存する

主菜・副菜・汁物を全て選び終わったら、画面に表示された「保存」ボタンをクリックして、献立を履歴に保存できます。

他に知りたいことはありますか？"""
    
    def generate_auxiliary_detail(self) -> str:
        """補助機能の詳細応答を生成"""
        return """ユーザープロフィール画面から、在庫一覧やレシピ履歴を確認できる便利な機能です。

### 在庫一覧を確認する

ユーザープロフィール画面から、現在の在庫一覧を確認できます。

**使い方**:
- ユーザープロフィール画面で「在庫一覧」を開く
- またはチャットで「在庫を教えて」と入力

**確認は不要**: すぐに表示されます。

在庫を追加・削除・変更すると、この一覧にすぐ反映されます。

### レシピ履歴を確認する

ユーザープロフィール画面から、過去に作った献立の履歴を確認できます。

**使い方**:
- ユーザープロフィール画面で「レシピ履歴」を開く
- またはチャットで「過去の献立を教えて」と入力

**確認は不要**: すぐに表示されます。

過去14日間（デフォルト）の献立が表示されます。

**履歴はどうやって保存されるの？**
段階的選択で主菜・副菜・汁物を選び終わって、画面に表示された「保存」ボタンをクリックすると、履歴として保存されます。保存した献立は、この履歴一覧からいつでも見返すことができます。

他に知りたいことはありますか？"""
    
    def generate_detail(self, detail_number: int) -> Optional[str]:
        """機能別詳細の応答を生成
        
        Args:
            detail_number: 1-4の数字（在庫/献立一括/献立段階的/補助機能）
        
        Returns:
            応答文字列（無効な数字の場合はNone）
        """
        handlers = {
            1: self.generate_inventory_detail,
            2: self.generate_menu_bulk_detail,
            3: self.generate_menu_staged_detail,
            4: self.generate_auxiliary_detail
        }
        
        handler = handlers.get(detail_number)
        if handler:
            return handler()
        return None

