# Phase 2D: 主菜提案にWeb検索機能追加（4タスク構成への拡張）

## 概要

現状の主菜提案機能（3タスク構成）を、Web検索機能を追加した4タスク構成に拡張します。これにより、ユーザーがレシピの詳細情報（画像、URL、詳細説明）を確認してから選択できるようになります。

## 現状の問題点

### **異常な状況**
- レシピのタイトルだけでは**ユーザーが選びようがない**
- 画像も詳細もない状態で選択を強要
- **情報不足**で適切な判断ができない
- ユーザー体験が**威圧的で強制的**

## 解決策

### **実装すべき機能**
1. **レシピURL取得**: 提案されたレシピからWeb検索でURLを取得
2. **画像表示**: URLからプリ画像を表示
3. **ポップアップビューアー**: 見やすい別ビューで表示
4. **詳細サイト遷移**: クリックで別タブで詳細サイトへ遷移
5. **詳細確認後の選択**: ユーザーが詳細を見てから選択

## タスク構成の変更

### **現状（3タスク構成）**
```
task1: inventory_service.get_inventory() - 在庫取得
task2: history_service.history_get_recent_titles() - 履歴取得
task3: recipe_service.generate_main_dish_proposals() - 主菜提案
```

### **新構成（4タスク構成）**
```
task1: inventory_service.get_inventory() - 在庫取得
task2: history_service.history_get_recent_titles() - 履歴取得
task3: recipe_service.generate_main_dish_proposals() - 主菜提案
task4: recipe_service.search_recipes_from_web() - Web検索 ← 追加
```

### **依存関係**
- task1 → task2, task3 (並列実行)
- task2 → task3 (履歴データ注入)
- task3 → task4 (提案レシピのタイトル注入)

## 実装計画（段階的アプローチ）

### **Phase 2D-1: バックエンド実装 + 試験**
- プランナーの更新（3→4タスク構成）
- Web検索機能の拡張
- バックエンド単体テスト

### **Phase 2D-2: フロントエンド実装**
- レシピ画像表示コンポーネント
- SelectionOptionsの拡張
- レシピ詳細モーダル

### **Phase 2D-3: 結合試験**
- エンドツーエンドテスト
- パフォーマンステスト
- ユーザー体験テスト
- エラーハンドリングテスト

## 実装順序

1. **Phase 2D-1** → バックエンド実装 + 試験
2. **Phase 2D-2** → フロントエンド実装（試験は無し。結合試験で兼ねる）
3. **Phase 2D-3** → 結合試験

## 期待される効果

### **ユーザー体験の改善**
- **情報不足の解消**: レシピの詳細情報（画像、説明、URL）を確認可能
- **選択の自由度向上**: 詳細を確認してから選択可能
- **威圧感の解消**: より柔らかく親しみやすいUI
- **判断材料の提供**: 画像と詳細説明で適切な判断が可能

### **技術的改善**
- **既存機能の活用**: 献立生成の4タスク構成を参考に実装
- **Web検索機能の拡張**: 既存のWeb検索機能を主菜提案に適用
- **フロントエンドの拡張**: 既存のUIコンポーネントを拡張
- **レスポンシブ対応**: モバイル・デスクトップ両対応

## 制約事項

- **既存機能の維持**: Phase 1-2の機能を破壊しない
- **パフォーマンス**: Web検索の追加による処理時間の増加を考慮
- **エラーハンドリング**: Web検索失敗時の適切な処理
- **画像取得**: 外部サイトの画像取得失敗時のフォールバック

## 詳細プラン

各フェーズの詳細な実装計画は以下のファイルを参照してください：

- [plan_Phase_2D_1.md](./plan_Phase_2D_1.md) - バックエンド実装 + 試験
- [plan_Phase_2D_2.md](./plan_Phase_2D_2.md) - フロントエンド実装
- [plan_Phase_2D_3.md](./plan_Phase_2D_3.md) - 結合試験

## 今後の拡張

- **Phase 3**: 副菜・汁物の段階的選択機能
- **Phase 4**: タスクチェーンのロールバック機能
- **Phase 5**: 履歴管理機能

この実装により、ユーザーが**詳細情報を確認してから選択**できる、より使いやすい主菜提案システムが完成します。